image:
    name: williamyeh/ansible:debian9

stages:
    - testing
    - deploy

before_script:
    - 'command -v ssh-agent >/dev/null || ( apt-get update -y && apt-get install openssh-client -y )'
    - eval $(ssh-agent -s)
    - echo "${SSH_PRIVATE_KEY}" | base64 -d | ssh-add - > /dev/null
    - mkdir -p ~/.ssh
    - chmod 700 ~/.ssh
    - ssh-keyscan -H 'mysyslogtest.ether.local' >> ~/.ssh/known_hosts
    - ssh-keyscan -H '10.0.0.90' >> ~/.ssh/known_hosts

Ansible playbook lint:
    stage: testing
    script:
       - echo "todo"

Deploy to dev:
    stage: testing
    script:
        - ansible-playbook -i inventories/dev/hosts mysyslog.yml -vv

Deploy to prod:
    stage: deploy
    script:
        - ansible-playbook -i inventories/prod/hosts mysyslog.yml -vv
