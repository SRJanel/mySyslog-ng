image:
    name: williamyeh/ansible:debian9

stages:
    - deploy_dev

before_script:
    - 'command -v ssh-agent >/dev/null || ( apt-get update -y && apt-get install openssh-client -y )'
    - eval $(ssh-agent -s)
    - echo "${SSH_PRIVATE_KEY}" | base64 -d | ssh-add - > /dev/null
    - mkdir -p ~/.ssh
    - chmod 700 ~/.ssh
    - ssh-keyscan -H 'mysyslogtest.ether.local' >> ~/.ssh/known_hosts

testing:
    stage: deploy_dev
    script:
        - ansible-playbook -i hosts mysyslog.yml -vv
